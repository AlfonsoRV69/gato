<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Espresso Machiato Eurovision Edition</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: url('https://pix.eurovisionworld.com/pix/eurovision-2025-stage.jpg') no-repeat center center fixed;
      background-size: cover;
      font-family: 'Comic Sans MS', 'Comic Sans', cursive, sans-serif;
      overflow-x: hidden;
    }
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.42);
      z-index: 0;
    }
    h1 {
      color: #fff;
      margin-top: 35px;
      font-size: 2.3em;
      letter-spacing: 1px;
      text-shadow: 2px 2px 8px #222, 0 2px 4px #b18b57aa;
      z-index: 2;
      position: relative;
    }
    .audio-container {
      margin: 10px 0 15px 0;
      z-index: 2;
      position: relative;
    }
    .stage-container {
      width: 100vw;
      display: flex;
      justify-content: center;
      align-items: end;
      height: 65vh;
      min-height: 350px;
      position: relative;
      z-index: 2;
      overflow: visible;
    }
    .tommy-cash {
      position: absolute;
      left: 50%;
      bottom: 0;
      width: 220px;
      height: 330px;
      z-index: 3;
      will-change: transform, filter;
      margin-bottom: 0;
      margin-top: 10px;
      filter: drop-shadow(0 4px 18px #000c) drop-shadow(0 0px 10px #fff6);
      transition: filter 0.2s;
    }
    .paused-glow {
      filter: grayscale(0.5) blur(2px) drop-shadow(0 0 30px #888e) !important;
    }
    /* Spotlights */
    .lights {
      position: absolute;
      left: 50%;
      bottom: 70px;
      width: 380px;
      height: 220px;
      pointer-events: none;
      z-index: 2;
      transform: translateX(-50%);
    }
    .light {
      position: absolute;
      border-radius: 50%;
      opacity: 0.7;
      filter: blur(22px);
      animation: lightPulse 2s infinite alternate;
      mix-blend-mode: lighten;
    }
    .light.l1 { left: 28px;  top: 90px; width: 110px; height: 44px; background: #fff777; animation-delay: 0s;}
    .light.l2 { left: 200px; top: 110px; width: 100px; height: 42px; background: #ff49d3; animation-delay: 0.5s;}
    .light.l3 { left: 150px; top: 20px; width: 140px; height: 58px; background: #00d9ff; animation-delay: 1.0s;}
    .light.l4 { left: 100px; top: 150px;width: 90px; height: 36px; background: #fff; animation-delay: 0.7s;}
    @keyframes lightPulse {
      0% { opacity: 0.5; filter: blur(30px) brightness(1);}
      50% { opacity: 1; filter: blur(12px) brightness(2.5);}
      100% { opacity: 0.7; filter: blur(26px) brightness(1.7);}
    }
    /* Flash sincronizado con el beat */
    .flash-beat {
      position: absolute;
      left: 0; top: 0; width: 100%; height: 100%;
      pointer-events: none;
      background: radial-gradient(ellipse at center, rgba(255,255,255,0.21) 0%,rgba(255,255,255,0) 65%);
      opacity: 0;
      z-index: 10;
      transition: opacity 0.14s;
    }
    .flash-beat.active {
      opacity: 1;
      transition: opacity 0.07s;
    }
    @media (max-width: 600px) {
      .stage-container { height: 38vh; }
      .tommy-cash { width: 120px; height: 180px;}
      .lights { width: 170px; height: 120px;}
    }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <h1>Eurovision Espresso Machiato ðŸŽ¤âœ¨</h1>
  <div class="audio-container">
    <audio id="audio" controls>
      <source src="espresso-machiato.mp3" type="audio/mp3">
      Your browser does not support the audio element.
    </audio>
  </div>
  <div class="stage-container">
    <div class="lights" id="lights">
      <div class="light l1"></div>
      <div class="light l2"></div>
      <div class="light l3"></div>
      <div class="light l4"></div>
    </div>
    <img 
      src="https://i.imgur.com/8lxBW41.png"
      alt="Tommy Cash bailando" 
      class="tommy-cash"
      draggable="false"
      oncontextmenu="return false;"
      id="tommy"
    >
    <div class="flash-beat" id="flash"></div>
  </div>
  <script>
    // --- CONFIGURACIÃ“N DE RITMO ---
    const BPM = 125;
    const BEAT_INTERVAL = 60 / BPM; // segundos por beat (~0.48s)

    // PatrÃ³n de baile mÃ¡s exagerado y variado (mÃ¡s saltos, giros, zoom, etc.)
    const DANCE_PATTERN = [
      [50, 0,    0,   1.1, 0],    // centro, normal
      [40, 68, -32,   1.27, 18],  // extrema izq, salto grande y giro
      [60, 0,   29,   1.18, -20], // extrema der., bajada con giro fuerte
      [50, 54, -20,   1.22, 6],   // centro, salto alto y skew
      [62, 0,   38,   1.24, -23], // extrema der., giro extremo, bajada
      [38, 70, -36,   1.32, 21],  // extrema izq, salto mÃ¡ximo y giro
      [50, 0,    0,   1.11, 0],   // centro, normal
      [55, 41,  29,   1.19, -10], // derecha, salto medio
      [45, 15, -22,   1.12, 11],  // izquierda, leve salto
      [50, 0,    0,   1.1, 0],    // centro, normal
      [50, 120, 0,   1.45, 0],    // salto vertical enorme (efecto wow)
      [50, 0,    0,   1.1, 0],    // centro
    ];

    const audio = document.getElementById('audio');
    const tommy = document.getElementById('tommy');
    const flash = document.getElementById('flash');
    let lastBeat = -1;
    let lastTime = 0;
    let patternIndex = 0;
    let dancing = false;

    function animateTommy() {
      if (audio.paused || audio.ended) {
        tommy.classList.add('paused-glow');
        requestAnimationFrame(animateTommy);
        return;
      }
      tommy.classList.remove('paused-glow');
      const t = audio.currentTime;
      // En quÃ© beat estamos, incluyendo decimales
      const beatFloat = t / BEAT_INTERVAL;
      const beat = Math.floor(beatFloat);

      // Efecto flash rÃ¡pido exactamente en cada beat
      if (beat !== lastBeat) {
        flash.classList.add('active');
        setTimeout(() => flash.classList.remove('active'), 90);
        patternIndex = (patternIndex + 1) % DANCE_PATTERN.length;
        lastBeat = beat;
      }

      // InterpolaciÃ³n para suavizar la transiciÃ³n entre poses
      const frac = (beatFloat % 1);
      const curr = DANCE_PATTERN[patternIndex];
      const next = DANCE_PATTERN[(patternIndex + 1) % DANCE_PATTERN.length];

      // Interpolamos cada valor (mÃ¡s exagerado y rÃ¡pido)
      const lerp = (a, b, f) => a + (b - a) * f;
      const x = lerp(curr[0], next[0], frac);
      const y = lerp(curr[1], next[1], frac);
      const rot = lerp(curr[2], next[2], frac);
      const zoom = lerp(curr[3], next[3], frac);
      const skew = lerp(curr[4], next[4], frac);

      tommy.style.left = x + "%";
      tommy.style.bottom = y + "px";
      tommy.style.transform =
        `translate(-50%,0) scale(${zoom},${1.08 + Math.abs(Math.sin(t*2.1))*0.15}) rotate(${rot}deg) skewX(${skew}deg)`;

      requestAnimationFrame(animateTommy);
    }

    // Controla el baile segÃºn el audio
    function updateDancing() {
      if (!audio.paused && !audio.ended) {
        animateTommy();
      }
    }

    // Espera interacciÃ³n para permitir reproducir audio (polÃ­ticas de navegador)
    window.addEventListener('click', () => { audio.play(); }, { once: true });
    window.addEventListener('keydown', () => { audio.play(); }, { once: true });

    audio.addEventListener('play', updateDancing);
    audio.addEventListener('pause', () => { tommy.classList.add('paused-glow'); });
    audio.addEventListener('ended', () => { tommy.classList.add('paused-glow'); });

    // Si el audio ya estÃ¡ sonando, inicia animaciÃ³n igual
    if (!audio.paused) updateDancing();
    else tommy.classList.add('paused-glow');
  </script>
</body>
</html>
